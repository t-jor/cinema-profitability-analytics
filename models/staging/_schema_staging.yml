version: 2

models:
  - name: stg_invoices
    description: |
      Represents the invoices issued for showing a specific movie at various theater locations during different months. 
      Data was passed by “Silver Screen” accountants.
      Note: 
      - movie_id may exist with different release_dates, different from information in movie_catalogue
      - total_invoice_sum (rental_cost) usually represents 4 weeks, a full month, even if the release_date is during this current month
      - For the analysis all total_invoice_sum (rental_cost) have been considered (as the have specific invoice_ids)
    columns:
      - name: monthly_invoices_key
        data_type: varchar
        description: |
          Surrogate key for joining with int_monthly_revenues to build int_monthly_performance.
          Key created from movie_id, month and location as no unique PK exists.
          Macro used: # dbt_utils.generate_surrogate_key(['movie_id', 'month', 'location']) # as monthly_invoices_key
        tests:
          - unique
          - not_null      
      
      - name: movie_id
        data_type: varchar
        description: "A unique identifier for each movie, typically consisting of the studio, year, and a unique movie code."
        tests:
          - not_null

      - name: month
        data_type: date
        description: "The month in which the invoice was issued, in the format YYYY-MM-01 - first day of the month."
        tests:
          - not_null

      - name: location
        data_type: varchar
        description: "The identifier of the cinema location, which is where the movie was shown. Renamed from 'location_id'"
        tests:
          - not_null

      - name: rental_cost
        data_type: number
        description: |
          The total sum of the invoice for the week, typically calculated as the weekly price multiplied by the number of weeks or total shows.
          Renamed from 'sum(total_invoice_sum)''.
        tests:
          - not_null



  - name: stg_movie_catalogue
    description: "Table contains detailed information about movies released in 2024 and rented out by 'Silver Screen'."
    columns:
      - name: movie_id
        data_type: varchar
        description: "Unique identifier for each movie, often composed of a combination of studio, year, and a unique code."
        tests:
          - unique
          - not_null

      - name: movie_title
        data_type: varchar
        description: "The title of the movie."
        tests:
          - unique
          - not_null

      - name: genre
        data_type: varchar
        description: "The genre of the movie, describing the type of content. Missing information has been replaced by 'Unknown'"
        tests:
          - not_null

      - name: studio
        data_type: varchar
        description: "The production studio responsible for making the movie."
        tests:
          - not_null


  - name: stg_nj_001
    description: |
      Information on all transactions from Silverscreen cinemas, New Jersey, location No.1.
      Monthly aggregation.
    columns:
      - name: movie_id
        data_type: varchar
        description: "A unique identifier for the movie being viewed in the transaction, usually tied to the movie's ID."
        tests:
          - not_null

      - name: month
        data_type: date
        description: |
          The date the transaction occurred, formatted as YYYY-MM-01 - first day of the month. 
          Renamed from 'timestamp'.
          Aggregated to monthly.
        tests:
          - not_null

      - name: location
        data_type: varchar
        description: "Added column to identify location No.1 when combining sales data from all three locations"
        tests:
          - not_null

      - name: tickets_sold
        data_type: number
        description: "The number of tickets purchased in this particular transaction. Reneamed from 'sum(ticket_amount)'."
        tests:
          - not_null
          - no_negative_values

      - name: revenue
        data_type: number
        description: "The total amount of money spent in the transaction, calculated as ticket_amount * price. Renamed from 'sum(transaction_total)'."
        tests:
          - not_null  
          - no_negative_values


  - name: stg_nj_002
    description: |
      Information on all transactions from Silverscreen cinemas, New Jersey, location No.2.
      Monthly aggregation.
    columns:
      - name: movie_id
        data_type: varchar
        description: "A unique identifier for the movie being sold, typically tied to a movie's ID."
        tests:
          - not_null

      - name: month
        data_type: date
        description: |
          The date of the ticket sales transaction, formatted as YYYY-MM-01 - first day of the month.
          Renamed from 'date'.
          Aggregated to monthly.
        tests:
          - not_null

      - name: location
        data_type: varchar
        description: "Added column to identify location No.2 when combining sales data from all three locations."
        tests:
          - not_null

      - name: tickets_sold
        data_type: number
        description: "The number of tickets sold on the given day. Renamed from 'sum(ticket_amount)'."
        tests:
          - not_null
          - no_negative_values

      - name: revenue
        data_type: number
        description: |
          The total revenue earned from ticket sales on the specified date, calculated as ticket_amount * ticket_price.
          Renamed from 'sum(total_earned)'.
        tests:
          - not_null
          - no_negative_values
  


  - name: stg_nj_003
    description: |
      Information on all transactions from Silverscreen cinemas, New Jersey, location No.3.
      Monthly aggregation.
    columns:
      - name: movie_id
        data_type: varchar
        description: |
          For tickets, this indicates the movie being viewed, represented by the movie_id. For other products, it remains empty or unspecified.
          Renamed from 'details' where 'product_type' = 'ticket'.
        tests:
          - not_null

      - name: month
        data_type: date
        description: | 
          The date when the transaction occurred, formatted as YYYY-MM-01 - first day of the month.
          Renamed from 'timestamp'.
          Aggregated to monthly.
        tests:
          - not_null

      - name: location
        data_type: varchar
        description: "Added column to identify location No.3 when combining sales data from all three locations."
        tests:
          - not_null

      - name: tickets_sold
        data_type: number
        description: "The quantity of the product purchased in the transaction. Renamed from 'sum(amount)', where product_type = 'ticket'."
        tests:
          - not_null
          - no_negative_values

      - name: revenue
        data_type: number
        description: "The total amount spent in the transaction, calculated as amount * price. Renamed from 'sum(total_value)'."
        tests:
          - not_null
          - no_negative_values